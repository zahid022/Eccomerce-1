let data = [
    {
        "category_name": "Meyvə",
        "products": [
            {
                "id": 1,
                "name": "Banan",
                "endirim": false,
                "old_price": 0,
                "price": 2.99,
                "category": "Meyvə",
                "image": "https://bazarstore.az/cdn/shop/products/30015539.jpg?v=1693895477"
            },
            {
                "id": 2,
                "name": "Çiyələk",
                "endirim": true,
                "old_price": 3.55,
                "price": 2.99,
                "category": "Meyvə",
                "image": "https://strgimgr.umico.az/sized/280/806806-78d65d8601a89f695aee3758eb80b370.jpg"
            },
            {
                "id": 3,
                "name": "Limon",
                "endirim": false,
                "old_price": 0,
                "price": 0.33,
                "category": "Meyvə",
                "image": "https://strgimgr.umico.az/sized/280/542423-13ebc56f434c8ae688135fe6c684b73e.jpg"
            },
            {
                "id": 4,
                "name": "Ərik",
                "endirim": true,
                "old_price": 2.64,
                "price": 2.24,
                "category": "Meyvə",
                "image": "https://strgimgr.umico.az/sized/280/821007-2260293ac9c6c8d0f53b35942233d7cc.jpg"
            },
            {
                "id": 5,
                "name": "Alma",
                "endirim": false,
                "old_price": 0,
                "price": 1.55,
                "category": "Meyvə",
                "image": "https://strgimgr.umico.az/sized/280/702475-27b2f18907c9924fe738d7dab9bd18fe.jpg"
            },
        ],
    },
    {
        "category_name": "Tərəvəz",
        "products": [
            {
                "id": 6,
                "name": "Xiyar",
                "endirim": true,
                "old_price": 0.71,
                "price": 0.58,
                "category": "Tərəvəz",
                "image": "https://strgimgr.umico.az/sized/280/702779-5ed31fa7923d58d4837de3750b5bf417.jpg"
            },
            {
                "id": 7,
                "name": "Pomidor",
                "endirim": true,
                "old_price": 3.49,
                "price": 2.29,
                "category": "Tərəvəz",
                "image": "https://strgimgr.umico.az/sized/280/588608-df95fb0086c5cdda035538c4f0ed7d36.jpg"
            },
            {
                "id": 8,
                "name": "Kök",
                "endirim": true,
                "old_price": 0.48,
                "price": 0.41,
                "category": "Tərəvəz",
                "image": "https://bazarstore.az/cdn/shop/products/30066563_767x1000.jpg?v=1693393631"
            },
            {
                "id": 9,
                "name": "Soğan",
                "endirim": true,
                "old_price": 0.55,
                "price": 0.45,
                "category": "Tərəvəz",
                "image": "https://strgimgr.umico.az/sized/280/544808-5e813aad479c91eeb098a4a3254f98ed.jpg"
            },
            {
                "id": 10,
                "name": "Bibər",
                "endirim": true,
                "old_price": 3.15,
                "price": 2.49,
                "category": "Tərəvəz",
                "image": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRLr9cYfq_rqwwYNKa21PkNYMKY4EU5ZuY1IYw0d_Euew&s"
            },
        ],
    },
    {
        "category_name": "Alkaqollu İçkilər",
        "products": [
            {
                "id": 11,
                "name": "Nemiroff",
                "endirim": false,
                "old_price": 0,
                "price": 18.21,
                "category": "Alkaqollu İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/543297-32fbed5dcb202f9b736f5b754e436210.jpg"
            },
            {
                "id": 12,
                "name": "Yeni Rakı",
                "endirim": false,
                "old_price": 0,
                "price": 44.99,
                "category": "Alkaqollu İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/542386-44b24d45c8446ab8ea1a90a255fad0a2.jpg"
            },
            {
                "id": 13,
                "name": "Mamedoff",
                "endirim": true,
                "old_price": 17.89,
                "price": 12.99,
                "category": "Alkaqollu İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/541080-de523ffce3a156bc03ef6b9811a2b9cc.jpg"
            },
            {
                "id": 14,
                "name": "Savalan",
                "endirim": false,
                "old_price": 0,
                "price": 33.99,
                "category": "Alkaqollu İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/543794-ab93c3dca4f79ba1f6473566a6a983c5.jpg"
            },
            {
                "id": 15,
                "name": "Absolute",
                "endirim": false,
                "old_price": 0,
                "price": 58.65,
                "category": "Alkaqollu İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/626129-00af66dc5e878d9db9c8b09a702c70c2.jpg"
            },
        ],
    },
    {
        "category_name": "Soyuq İçkilər",
        "products": [
            {
                "id": 16,
                "name": "Coca-Cola",
                "endirim": false,
                "old_price": 0,
                "price": 1.41,
                "category": "Soyuq İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/543173-0c6e710e9596f08741be3ea13e828dee.jpg"
            },
            {
                "id": 17,
                "name": "Pepsi",
                "endirim": false,
                "old_price": 0,
                "price": 1.39,
                "category": "Soyuq İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/550429-0832aebf25bc4c705380847f4067aff4.jpg"
            },
            {
                "id": 18,
                "name": "Bizon",
                "endirim": false,
                "old_price": 0,
                "price": 0.71,
                "category": "Soyuq İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/542506-1a5b0d52b36055bc76a4f922391b66aa.jpg"
            },
            {
                "id": 19,
                "name": "I'm Tea",
                "endirim": false,
                "old_price": 0,
                "price": 1.45,
                "category": "Soyuq İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/541263-670867aa74d53bf0ee9402447bc92a8b.jpg"
            },
            {
                "id": 20,
                "name": "Sirab",
                "endirim": false,
                "old_price": 0,
                "price": 0.85,
                "category": "Soyuq İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/541246-5c37abdc753620984cd4b536a0678152.jpg"
            },
        ],
    },
    {
        "category_name": "İsti İçkilər",
        "products": [
            {
                "id": 21,
                "name": "Green-Field Çayı",
                "endirim": false,
                "old_price": 0,
                "price": 3.15,
                "category": "İsti İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/547386-af16764439000c5ff8daa8904ddb0f91.jpg"
            },
            {
                "id": 22,
                "name": "Azərçay",
                "endirim": true,
                "old_price": 11.80,
                "price": 9.29,
                "category": "İsti İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/546924-cc87e50b42864320454bce121c845b81.jpg"
            },
            {
                "id": 23,
                "name": "Berqa çayı",
                "endirim": false,
                "old_price": 0,
                "price": 6.05,
                "category": "İsti İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/547262-df8e84b5badd4bb75073beddb180403f.jpg"
            },
            {
                "id": 24,
                "name": "Tess çayı",
                "endirim": false,
                "old_price": 0,
                "price": 11.75,
                "category": "İsti İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/547267-a3320f6747f925c61ba514d9fd70035a.jpg"
            },
            {
                "id": 25,
                "name": "Champion",
                "endirim": false,
                "old_price": 0,
                "price": 6.49,
                "category": "İsti İçkilər",
                "image": "https://strgimgr.umico.az/sized/280/546904-28a1be74575eddce2cc636b40eb35ea4.jpg"
            },
        ],
    },
    {
        "category_name": "Saç Şampunları",
        "products": [
            {
                "id": 26,
                "name": "Head & Shoulders",
                "endirim": true,
                "old_price": 11.39,
                "price": 5.49,
                "category": "Saç Şampunları",
                "image": "https://strgimgr.umico.az/sized/280/801942-25d8f7ddf762b9de442b1fbd763a9705.jpg"
            },
            {
                "id": 27,
                "name": "DR.Sante",
                "endirim": false,
                "old_price": 0,
                "price": 13.59,
                "category": "Saç Şampunları",
                "image": "https://strgimgr.umico.az/sized/280/545801-992d263696dead1f453d65deacfb9861.jpg"
            },
            {
                "id": 28,
                "name": "Pantene",
                "endirim": false,
                "old_price": 0,
                "price": 13.69,
                "category": "Saç Şampunları",
                "image": "https://strgimgr.umico.az/sized/280/743273-c8bf8d36c7498c7d7f13f1944d870ea8.jpg"
            },
            {
                "id": 29,
                "name": "Restorex",
                "endirim": false,
                "old_price": 0,
                "price": 5.15,
                "category": "Saç Şampunları",
                "image": "https://strgimgr.umico.az/sized/280/544652-3761a6a905f2ffb685c8b58b85da9af5.jpg"
            },
            {
                "id": 30,
                "name": "Elseve",
                "endirim": false,
                "old_price": 0,
                "price": 8.59,
                "category": "Saç Şampunları",
                "image": "https://strgimgr.umico.az/sized/280/546368-fc55cee096f7a2d0cbfc71dd20379e8f.jpg"
            },
        ],
    },
]

const sidebar = document.getElementById('sidebar')
const allDepartaments = document.getElementById('all-departaments')
const allCategory = document.getElementById('all-category')
const categoryBtns = document.getElementById('category-btns')
const cardContainer = document.getElementById('card-container')
const searchInput = document.getElementById('search-input')
const basketContent = document.getElementById('basket-content')
const sebetlog = document.getElementById("sebetlog")
const basket = document.getElementById('basket')
const ConfirmCont = document.getElementById('Confirm-cont')

let data_products = []
let search_product = []
let name_product = []
let sebet = []

function ShowSidebar() { sidebar.classList.toggle('translate-x-[-100%]') }

function ShowCategory() {
    data.forEach((item, i) => {
        allDepartaments.innerHTML += `<li  class="py-2"><a onclick="GetFilter(${i})" class="text-[16px] search-links text-[#1c1c1c] font-normal" href="#important-products">${item.category_name}</a></li>`
        allCategory.innerHTML += `<option value="${item.category_name}">${item.category_name}</option>`
        categoryBtns.innerHTML += `<button onclick="GetSearch(${i + 1})" class="mx-3 mb-2 text-[18px] search-btns font-normal">${item.category_name}</button>`
    })
}

ShowCategory()

function GetCard() {
    data.map(item => {
        data_products.push(...item.products)
    })
    data_products.map(item => {
        item.count = 1
        cardContainer.innerHTML += ShowCard(item)
    })
}
GetCard()

function GetFilter(a) {
    cardContainer.innerHTML = ''
    const searchLinks = document.querySelectorAll('.search-links')
    data_products.map(item => {
        if (item.category === searchLinks[a].innerHTML) {
            cardContainer.innerHTML += ShowCard(item)
        }
    })
}

function GetSearch(a) {
    cardContainer.innerHTML = ''
    const searchBtns = document.querySelectorAll('.search-btns')
    if (searchBtns[a].innerHTML != "All") {
        data_products.map(item => {
            if (item.category === searchBtns[a].innerHTML) {
                cardContainer.innerHTML += ShowCard(item)
            }
        })
    } else {
        data_products.map(item => {
            cardContainer.innerHTML += ShowCard(item)
        })
    }
}

function SearchProduct() {
    cardContainer.innerHTML = ""
    let input = searchInput.value.toLowerCase()

    if (allCategory.value != "") {
        search_product = data_products.filter(item => {
            return item.category === allCategory.value
        })
    } else if (allCategory.value == "") {
        search_product = data_products
    }

    if (searchInput.value != "") {
        search_product = search_product.filter(item => item.name.toLowerCase().includes(input))
    }

    if (search_product.length) {
        search_product.map(item => {
            cardContainer.innerHTML += ShowCard(item)
        })
    } else {
        cardContainer.innerHTML = "Filteriniz Səhvdir !!!"
    }
}

function ShowBasket() {
    basketContent.classList.toggle('opacity-0')
    basketContent.classList.toggle('z-[-1]')
    basketContent.classList.toggle('z-[900]')
    if (sebet.length === 0) {
        sebetlog.innerHTML = `<li class="text-center">Sizin səbətiniz boşdur. Alış-veriş üçün <span onclick="ShowBasket()" class="text-[blue] cursor-pointer">BURA</span> klik edin.</li>`
    }
    Confirm()
}

function ShowCard(item) {
    return `<div id="a${item.id}" class="size-full mb-5 md:size-6/12 lg:size-3/12 px-3">
                <div class="border text-center h-[430px] flex flex-col justify-between p-7 rounded-lg relative">
                    <div class="absolute ${item.endirim ? '' : 'hidden'} top-5 left-5 bg-[red] flex h-[40px] w-[40px] items-center justify-center rounded-full">
                        <span class="text-white">${(100 - (item.price / item.old_price) * 100).toFixed(0)}%</span>
                    </div>
                    <div class="h-[230px] overflow-hidden">
                        <img class="w-[188px] h-[220px] object-cover mx-auto" src="${item.image}" />
                    </div>
                    <p class="font-normal text-[24px] capitalize">${item.name}</p>
                    <p class="mb-2">
                        <span class="text-[#b34242] mr-2 font-bold text-[30px]">₼ ${item.price}</span>
                        <span class="line-through ${item.endirim ? '' : 'hidden'} text-[#bcbaba]">₼ ${item.old_price}</span>
                    </p>
                    <button onclick="AddBasket(${item.id})" class="bg-[#7fad39] font-bold hover:bg-[#7ead39d0] duration-[.3s] text-white text-[16px] px-6 py-3 rounded-md">Add to Card</button>
                </div>
            </div>`
}

function AddBasket(id) {
    let element = data_products.filter(item => item.id === id)
    let Isinbasket = sebet.some(item => item.id === element[0].id)
    if (Isinbasket) {
        element[0].count++
    }else{
        sebet.push(element[0])
    }
    sebetlog.innerHTML = ""
    basket.innerHTML = `
        <span class="absolute top-[-10px] right-[-10px] w-[30px] h-[30px] ${sebet.length ? 'flex' : 'hidden'} items-center justify-center bg-[red] text-white rounded-full">${sebet.length}</span>
        <i class="fas fa-shopping-basket"></i>
        `

    sebet.map((item) => sebetlog.innerHTML += sebetContent(item))

}

function handleDelete(x) {
    sebet = sebet.filter((item) => item.id !== x)
    sebetlog.innerHTML = ""
    basket.innerHTML = `
        <span class="absolute ${sebet.length ? 'flex' : 'hidden'} top-[-10px] right-[-10px] w-[30px] h-[30px]  items-center justify-center bg-[red] text-white rounded-full">${sebet.length}</span>
        <i class="fas fa-shopping-basket"></i>
    `
    if (sebet.length) {
        sebet.map((item) => sebetlog.innerHTML += sebetContent(item)) 
    }else{
        sebetlog.innerHTML = `<li class="text-center">Sizin səbətiniz boşdur. Alış-veriş üçün <span onclick="ShowBasket()" class="text-[blue] cursor-pointer" >BURA</span> klik edin.</li>`
    }   
    Confirm()                                                           
}

function sebetContent(item) {
    return ` <li class="flex justify-between items-center mb-3 py-2 border-b px-4">
                <div class="flex justify-between size-10/12 items-center">
                    <p class="inline-block md:w-[180px] mr-1 text-[20px] font-bold">${item.name}</p>
                    <p class="inline-block md:w-[70px]  mr-2 text-[14px] font-semibold text-[red]">${item.price} ₼</p>
                    <button class="p-1 bg-[#eee] mx-1 rounded-lg w-[30px]" onclick="deyis(${item.id}, -1)">-</button>
                    <span class="count-item${item.id} md:mx-2">${item.count}</span>
                    <button class="p-1 bg-[#eee] mx-1 rounded-lg w-[30px]" onclick="deyis(${item.id}, 1)">+</button>
                </div>
                <div class="size-2/12 text-right">
                    <button onclick="handleDelete(${item.id})" class="text-[18px] text-[#222]">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </li>
    `
}

function deyis(id, x){
    const CountItem = document.querySelector(`.count-item${id}`)
    const element = sebet.find(item => item.id === id)
    element.count += x
    if (element.count < 1) {
        handleDelete(id)
        element.count = 1
    }
    CountItem.innerHTML = element.count
    Confirm()
}

function Confirm(){
    let price = 0
    sebet.map(item => price += (item.price * item.count))
    ConfirmCont.innerHTML = price.toFixed(2) + " ₼ "
}